services:
  mictlanx-router-0:
    image: nachocode/mictlanx:router
    container_name:  mictlanx-router-0
    environment:
      - LOGGER_NAME=mictlanx-router-0
      - LOG_PATH=/log
      - TEZCANALYTICX_FLUSH_TIMEOUT=10s
      - TEZCANALYTICX_BUFFER_SIZE=100
      - TEZCANALYTICX_PATH=/api/v4/events
      - TEZCANALYTICX_PORT=45000
      - TEZCANALYTICX_HOSTNAME=tezcanalyticx-0
      - TEZCANALYTICX_LEVEL=0
      - TEZCANALYTICX_PROTOCOL=http
      - TEZCANALYTICX_ENABLE=0
      #- MICTLANX_PEERS=peer-0:localhost:7000
      - MICTLANX_PROCOTOL=http
      - MICTLANX_API_VERSION=4
      - MICTLANX_PEER_HEALER_HEARTBEAT=30sec
      - MICTLANX_GC_HEARTBEAT=60sec
      - MICTLANX_ROUTER_HOST=${MICTLANX_ROUTER_HOST-0.0.0.0}
      - MICTLANX_ROUTER_PORT=${MICTLANX_ROUTER_PORT-60666}
      - MICTLANX_SUMMONER_API_VERSION=3
      - MICTLANX_SUMMONER_IP_ADDR=mictlanx-summoner-0
      - MICTLANX_SUMMONER_PORT=15000
      - MICTLANX_SUMMONER_SUBNET=10.0.0.0/25
    command: uvicorn mictlanxrouter.server:app --host ${MICTLANX_ROUTER_HOST-0.0.0.0} --port ${MICTLANX_ROUTER_PORT-60666}
    ports:
      - ${MICTLANX_ROUTER_PORT-60666}:${MICTLANX_ROUTER_PORT-60666}
    volumes:
      - mictlanx-router-0_logs:/log
    networks:
      - mictlanx
    restart: unless-stopped


  mictlanx-summoner-0:
    image: nachocode/mictlanx:summoner
    container_name: mictlanx-summoner-0
    hostname: mictlanx-summoner-0
    privileged: true
    ports:
      - 15000:15000
    environment:
      - USER_ID=1001
      - GROUP_ID=1002
      - DOCKER_GID=1001
      - BASE_PATH=${BASE_PATH-/app/mictlanx}
      - BIN_NAME=summoner
      - NODE_ID=mictlanx-summoner-0
      - NODE_PORT=15000
      - IP_ADDRESS=mictlanx-summoner-0
      - SERVER_IP_ADDR=0.0.0.0
      - LOG_PATH=${BASE_PATH-/app/mictlanx}/log
      - LOCAL_PATH=${BASE_PATH-/app/mictlanx}/local
      - DATA_PATH=${BASE_PATH-/app/mictlanx}/data
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - mictlanx-summoner-0:/mictlanx
    networks:
      - mictlanx

  tezcanalyticx-0:
    image: nachocode/tezcanalyticx:api
    container_name:  tezcanalyticx-0
    environment:
    - LOGGER_PATH=/log
    - IP_ADDR=0.0.0.0
    - PORT=45000
    - RELOAD=1
    - PERIOD_WINDOW_TIME_SEC=30s
    - LOGGER_INTERVAL=24
    - LOGGER_WHEN=h
    command: uvicorn tezcanalyticx.server:app --host ${TEZCANALYTICX_IP_ADDR-0.0.0.0} --port ${TEZCANALYTICX_PORT-45000}
    ports:
    - ${PORT-45000}:${PORT-45000}
    volumes:
    - tezcanalyticx-0:/log
    networks:
    - mictlanx
    restart: unless-stopped
volumes:
  mictlanx-router-0_logs:
  tezcanalyticx-0:
  mictlanx-summoner-0:

networks:
  mictlanx:
    external: true
